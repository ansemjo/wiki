



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/planet.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.3.0">
    
    
      
        <title>ZFS in-place Encryption - ansemjo's docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.572ca0f0.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.962652e9.js"></script>
    
    
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#zfs-in-place-encryption" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="ansemjo's docs" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                ansemjo's docs
              </span>
              <span class="md-header-nav__topic">
                ZFS in-place Encryption
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/ansemjo/wiki/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      ansemjo/wiki
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../index.html" title="Home" class="md-tabs__link">
        Home
      </a>
    
  </li>

      
        
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../personal/löschungsantrag.html" title="Personal" class="md-tabs__link">
          Personal
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../rechenzentrum/index.html" title="Rechenzentrum" class="md-tabs__link">
          Rechenzentrum
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="secureboot.html" title="Security" class="md-tabs__link md-tabs__link--active">
          Security
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../tips/ansible.html" title="Tips" class="md-tabs__link">
          Tips
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="ansemjo's docs" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    ansemjo's docs
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/ansemjo/wiki/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      ansemjo/wiki
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../index.html" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../software.html" title="Software" class="md-nav__link">
      Software
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Personal
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Personal
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../personal/löschungsantrag.html" title="DSGVO Löschungsantrag" class="md-nav__link">
      DSGVO Löschungsantrag
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../personal/versicherungen.html" title="Versicherungen" class="md-nav__link">
      Versicherungen
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Rechenzentrum
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Rechenzentrum
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../rechenzentrum/index.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../rechenzentrum/bootstrap.html" title="Bootstrap" class="md-nav__link">
      Bootstrap
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../rechenzentrum/docker-in-kvm.html" title="Docker in QEMU/KVM" class="md-nav__link">
      Docker in QEMU/KVM
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../rechenzentrum/flynn.html" title="Flynn" class="md-nav__link">
      Flynn
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../rechenzentrum/kvm-on-alpine.html" title="KVM on Alpine" class="md-nav__link">
      KVM on Alpine
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../rechenzentrum/netboot.html" title="Network Boot" class="md-nav__link">
      Network Boot
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../rechenzentrum/tls-host-aliases.html" title="TLS for Host Aliases" class="md-nav__link">
      TLS for Host Aliases
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Security
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Security
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="secureboot.html" title="Secureboot" class="md-nav__link">
      Secureboot
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="systemd-decryption-target.html" title="Systemd Disk Decryption Target" class="md-nav__link">
      Systemd Disk Decryption Target
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        ZFS in-place Encryption
      </label>
    
    <a href="zfs-in-place-encryption.html" title="ZFS in-place Encryption" class="md-nav__link md-nav__link--active">
      ZFS in-place Encryption
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hot-encryption" title="Hot Encryption" class="md-nav__link">
    Hot Encryption
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example" title="Example" class="md-nav__link">
    Example
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rinse-repeat" title="Rinse &amp; Repeat" class="md-nav__link">
    Rinse &amp; Repeat
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#systemd-target" title="systemd Target" class="md-nav__link">
    systemd Target
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Tips
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Tips
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../tips/ansible.html" title="Ansible" class="md-nav__link">
      Ansible
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tips/backblaze.html" title="Backblaze" class="md-nav__link">
      Backblaze
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tips/coreos.html" title="CoreOS" class="md-nav__link">
      CoreOS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tips/docker.html" title="Docker" class="md-nav__link">
      Docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tips/freeipa.html" title="FreeIPA" class="md-nav__link">
      FreeIPA
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tips/git.html" title="Git" class="md-nav__link">
      Git
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tips/gitlab.html" title="Gitlab" class="md-nav__link">
      Gitlab
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tips/lenovo.html" title="Lenovo" class="md-nav__link">
      Lenovo
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tips/openwrt.html" title="OpenWRT" class="md-nav__link">
      OpenWRT
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tips/python.html" title="Python" class="md-nav__link">
      Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tips/restic.html" title="Restic" class="md-nav__link">
      Restic
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tips/tor.html" title="Tor" class="md-nav__link">
      Tor
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hot-encryption" title="Hot Encryption" class="md-nav__link">
    Hot Encryption
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example" title="Example" class="md-nav__link">
    Example
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rinse-repeat" title="Rinse &amp; Repeat" class="md-nav__link">
    Rinse &amp; Repeat
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#systemd-target" title="systemd Target" class="md-nav__link">
    systemd Target
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ansemjo/wiki/edit/master/docs/security/zfs-in-place-encryption.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="zfs-in-place-encryption">ZFS in-place Encryption</h1>
<p>There are basically two possibilities to encrypt an existing array's disks:</p>
<ol>
<li>
<p>perform in-place encryption of <em>cold</em> disks with <code>luksipc</code></p>
<ul>
<li>requires that you have enough free space at the end</li>
<li>will not work if your array is assembled from <code>/dev/disk/by-id/*</code> paths, since those will
  change</li>
</ul>
</li>
<li>
<p>iterate over <em>hot</em> disks by overwriting and resilvering each one</p>
<ul>
<li>will leave your array in a degraded but usable state</li>
<li>you should overwrite the entire disk to make sure plaintext traces are removed</li>
<li>depending on how full your array is you might need to write up to twice your raw accumulated
  disk size worth of data .. this takes <strong>a lot</strong> of time!</li>
</ul>
</li>
</ol>
<h2 id="hot-encryption">Hot Encryption</h2>
<p>I chose to use the latter method because there was not enough space at the end of the drives and I
was not sure how ZFS could handle the changed disk paths. A couple things to note:</p>
<ul>
<li>
<p>make sure you align all partitions / containers!</p>
<ul>
<li>check your <em>real</em> physical block size (the drive might lie)</li>
<li>check the <code>ashift</code> property of your pool</li>
</ul>
</li>
<li>
<p>use partitions, do not make the LUKS partition span the entire drive!</p>
<ul>
<li>begin the first partition at a multiple of your <code>pbs</code>, e.g. 4096 sectors / 2 MiB is a safe bet</li>
<li>account for the LUKS header (usually should be 2 MiB)</li>
<li>do not enlarge your partitions by too much, so you can replace them later on</li>
<li><strong>however</strong> make sure that the mapped device cannot be smaller than your original partition!</li>
</ul>
</li>
</ul>
<h3 id="example">Example</h3>
<p>For example, I originally had four <code>7809835008</code> sector partitions (<code>fdisk</code> uses 512 byte sectors
here).</p>
<table>
<thead>
<tr>
<th>Partition</th>
<th align="right">sectors (512 bytes)</th>
<th align="right">approximate size</th>
</tr>
</thead>
<tbody>
<tr>
<td>Original ZFS</td>
<td align="right">7809835008</td>
<td align="right">3813396 MiB</td>
</tr>
<tr>
<td>Full disk</td>
<td align="right">7814037168</td>
<td align="right">~ 3815447 MiB</td>
</tr>
<tr>
<td>Nominal 4 TiB disk</td>
<td align="right">7812500000</td>
<td align="right">~ 3814697 MiB</td>
</tr>
<tr>
<td>New ZFS</td>
<td align="right">7811072000</td>
<td align="right">3814000 MiB</td>
</tr>
<tr>
<td>New LUKS</td>
<td align="right">7811076096</td>
<td align="right">3814002 MiB</td>
</tr>
</tbody>
</table>
<h3 id="rinse-repeat">Rinse &amp; Repeat</h3>
<p>Assume the original pool looked like this:</p>
<div class="codehilite"><pre><span></span>kourier
  mirror-0                                                          ONLINE
    /dev/disk/by-id/ata-WDC_WD40EZRX-00SPEB0_WD-WCC4E0496927-part2  ONLINE
    /dev/disk/by-id/ata-HGST_HDN724040ALE640_PK1334PEHLZA1S-part2   ONLINE
  mirror-1                                                          ONLINE
    /dev/disk/by-id/ata-WDC_WD40EZRX-00SPEB0_WD-WCC4E0284683-part2  ONLINE
    /dev/disk/by-id/ata-HGST_HDN724040ALE640_PK1334PEHK98JS-part2   ONLINE
</pre></div>


<p>Take the first drive offline:</p>
<div class="codehilite"><pre><span></span>export DISK=&quot;WDC_WD40EZRX-00SPEB0_WD-WCC4E0496927&quot;
zpool offline kourier ata-<span class="cp">${</span><span class="n">DISK</span><span class="cp">}</span>-part2
</pre></div>


<p>Overwrite with zeroes or random data:</p>
<div class="codehilite"><pre><span></span>dd if=/dev/zero of=/dev/disk/by-id/ata-<span class="cp">${</span><span class="n">DISK</span><span class="cp">}</span> status=progress bs=1M
</pre></div>


<p>Create a new partition table and one partition with your desired size (the UUID sets the partition
type to <code>FreeBSD ZFS</code>):</p>
<div class="codehilite"><pre><span></span>printf &#39;%s\n&#39; \
  &quot;label: gpt&quot; \
  &quot;4096,+7811076096,516E7CBA-6ECF-11D6-8FF8-00022D09712B&quot; \
  | ./sfdisk-2.33 /dev/disk/by-id/ata-<span class="cp">${</span><span class="n">DISK</span><span class="cp">}</span>
</pre></div>


<p>Create and open the LUKS container with your desired cipher / hash / keysize settings:</p>
<div class="codehilite"><pre><span></span>cryptsetup luksFormat -h sha384 /dev/disk/by-id/ata-<span class="cp">${</span><span class="n">DISK</span><span class="cp">}</span>-part1
cryptsetup open /dev/disk/by-id/ata-<span class="cp">${</span><span class="n">DISK</span><span class="cp">}</span>-part1 <span class="cp">${</span><span class="n">DISK</span><span class="cp">}</span>_LUKS
</pre></div>


<p>Replace the drive in the pool and wait for it to resilver:</p>
<div class="codehilite"><pre><span></span>zpool replace kourier ata-<span class="cp">${</span><span class="n">DISK</span><span class="cp">}</span>-part2 /dev/mapper/<span class="cp">${</span><span class="n">DISK</span><span class="cp">}</span>_LUKS
watch -d zpool status -P
</pre></div>


<p>Rinse and repeat with all four disks. This is what my pool looks like now:</p>
<div class="codehilite"><pre><span></span>kourier
  mirror-0                                                 ONLINE
    /dev/mapper/WDC_WD40EZRX-00SPEB0_WD-WCC4E0496927_LUKS  ONLINE
    /dev/mapper/HGST_HDN724040ALE640_PK1334PEHLZA1S_LUKS   ONLINE
  mirror-1                                                 ONLINE
    /dev/mapper/WDC_WD40EZRX-00SPEB0_WD-WCC4E0284683_LUKS  ONLINE
    /dev/mapper/HGST_HDN724040ALE640_PK1334PEHK98JS_LUKS   ONLINE
</pre></div>


<h2 id="systemd-target"><code>systemd</code> Target</h2>
<p>My next task will be to create proper dependencies for all my systemd services. I do not want my
system to block boot, so I can later login and manually decrypt the disks. However I also don't want
to have services randomly fail or attempt to create nonexistent paths because the zpool is not
imported yet. They should just queue and wait for me to decrypt the drives and then automatically
continue once I've done that.</p>
<p>Useful pointers:</p>
<ul>
<li><code>systemd-cryptsetup@.service</code></li>
<li>bundling all encrypted disks in a <code>*.target</code></li>
<li><code>After=</code>, <code>RequiredBy=</code>/<code>WantedBy=</code> and <code>BindsTo=</code> properties of services</li>
<li><a href="https://www.freedesktop.org/software/systemd/man/systemd.unit.html">systemd.unit(5)</a></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See <a href="systemd-decryption-target.html">Systemd Decryption Target</a> for the finished result.</p>
</div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="systemd-decryption-target.html" title="Systemd Disk Decryption Target" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Systemd Disk Decryption Target
              </span>
            </div>
          </a>
        
        
          <a href="../tips/ansible.html" title="Ansible" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Ansible
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright (c) 2018 Anton Semjonov, licensed under Creative Commons BY-SA 4.0 (https://semjonov.de/license)
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.a353778b.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>