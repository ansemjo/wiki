<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Anton Semjonov">
  <link rel="shortcut icon" href="../assets/planet.png">
  
  <title>Git - ansemjo's docs</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Git";
    var mkdocs_page_input_path = "tips/git.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="icon icon-home"> ansemjo's docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../index.html">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../software.html">Software</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Personal</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../personal/löschungsantrag.html">DSGVO Löschungsantrag</a>
                </li>
                <li class="">
                    
    <a class="" href="../personal/versicherungen.html">Versicherungen</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Rechenzentrum</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../rechenzentrum/index.html">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../rechenzentrum/bootstrap.html">Bootstrap</a>
                </li>
                <li class="">
                    
    <a class="" href="../rechenzentrum/docker-in-kvm.html">Docker in QEMU/KVM</a>
                </li>
                <li class="">
                    
    <a class="" href="../rechenzentrum/flynn.html">Flynn</a>
                </li>
                <li class="">
                    
    <a class="" href="../rechenzentrum/kvm-on-alpine.html">KVM on Alpine</a>
                </li>
                <li class="">
                    
    <a class="" href="../rechenzentrum/netboot.html">Network Boot</a>
                </li>
                <li class="">
                    
    <a class="" href="../rechenzentrum/tls-host-aliases.html">TLS for Host Aliases</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Security</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../security/net-disk-decryption.html">Network Disk Decryption</a>
                </li>
                <li class="">
                    
    <a class="" href="../security/secureboot.html">Secureboot</a>
                </li>
                <li class="">
                    
    <a class="" href="../security/systemd-decryption-target.html">Systemd Disk Decryption Target</a>
                </li>
                <li class="">
                    
    <a class="" href="../security/zfs-in-place-encryption.html">ZFS in-place Encryption</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Tips</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="ansible.html">Ansible</a>
                </li>
                <li class="">
                    
    <a class="" href="backblaze.html">Backblaze</a>
                </li>
                <li class="">
                    
    <a class="" href="bash.html">Bash</a>
                </li>
                <li class="">
                    
    <a class="" href="centos.html">CentOS</a>
                </li>
                <li class="">
                    
    <a class="" href="containers.html">Containers</a>
                </li>
                <li class="">
                    
    <a class="" href="coreos.html">CoreOS</a>
                </li>
                <li class="">
                    
    <a class="" href="documentscan.html">Document Scanning</a>
                </li>
                <li class="">
                    
    <a class="" href="freeipa.html">FreeIPA</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="git.html">Git</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#git">Git</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#prevent-commits-on-a-branch">Prevent commits on a branch</a></li>
        
            <li><a class="toctree-l4" href="#merge-repositories">Merge Repositories</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="gitlab.html">Gitlab</a>
                </li>
                <li class="">
                    
    <a class="" href="golang.html">Go</a>
                </li>
                <li class="">
                    
    <a class="" href="lenovo.html">Lenovo</a>
                </li>
                <li class="">
                    
    <a class="" href="openwrt.html">OpenWRT</a>
                </li>
                <li class="">
                    
    <a class="" href="python.html">Python</a>
                </li>
                <li class="">
                    
    <a class="" href="restic.html">Restic</a>
                </li>
                <li class="">
                    
    <a class="" href="serialdevices.html">Serial</a>
                </li>
                <li class="">
                    
    <a class="" href="tor.html">Tor</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">ansemjo's docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
    
      
        
          <li>Tips &raquo;</li>
        
      
    
    <li>Git</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/ansemjo/wiki/edit/master/docs/tips/git.md"> Edit on ansemjo/wiki</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="git">Git<a class="headerlink" href="#git" title="Permanent link">&para;</a></h1>
<h2 id="prevent-commits-on-a-branch">Prevent commits on a branch<a class="headerlink" href="#prevent-commits-on-a-branch" title="Permanent link">&para;</a></h2>
<p>You can use a <code>pre-commit</code> hook to check the branch name to which you are commiting your changes. If
you want to prevent direct changes to <code>master</code> create the following <code>.git/hooks/pre-commit</code>:</p>
<pre class="codehilite"><code class="language-sh">#!/bin/sh

# prevent commits on master
[ &quot;$(git rev-parse --abbrev-ref --symbolic-full-name HEAD)&quot; == &quot;master&quot; ] \
  &amp;&amp; { echo &quot;you shall not commit on master&quot;; exit 1; }</code></pre>


<p>Make sure the hook script is executable.</p>
<h2 id="merge-repositories">Merge Repositories<a class="headerlink" href="#merge-repositories" title="Permanent link">&para;</a></h2>
<p>I&rsquo;ve had a few situations where I started front- and backend as two seperate projects but soon
wished to track both in a single repository - as subdirectories. Last time I was in this situation,
<a href="https://stackoverflow.com/a/6442034">a stackoverflow answer</a> proved most helpful. Here&rsquo;s the gist:</p>
<p>Assume you have two repositories <code>frontend</code> and <code>backend</code>.</p>
<h3 id="prepare-repositories">Prepare repositories<a class="headerlink" href="#prepare-repositories" title="Permanent link">&para;</a></h3>
<p>First, you should move all files in each repository into a subdirectory to avoid merge conflicts and
properly preserve commit history later. It would make sense to put all files in the <code>frontend</code>
repository into a <code>frontend</code> subdirectory .. etc.</p>
<pre class="codehilite"><code>⦁ project/front : master= $ mkdir frontend
⦁ project/front : master= $ mv !(frontend) frontend/
⦁ project/front : master *%= $ git add .
⦁ project/front : master += $ git commit
[master c777b42] prepare frontend for merge
 65 files changed, 0 insertions(+), 0 deletions(-)
 [...]</code></pre>


<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Don&rsquo;t forget about dotfiles, as those are not moved with <code>mv !(frontend) frontend/</code> alone.</p>
</div>
<p>Do the same analogously for the <code>backend</code> or any other repository you want to merge.</p>
<p>Also, create a new repository to hold the merged projects. It helps to create an initial commit &ndash;
even if completely empty &ndash; to indicate that unrelated histories were merged into each other.</p>
<pre class="codehilite"><code>⦁ project $ mkdir project &amp;&amp; cd project
⦁ project/project $ git init
⦁ project/project : master # $ git commit --allow-empty</code></pre>


<h3 id="add-and-fetch-remotes">Add and fetch remotes<a class="headerlink" href="#add-and-fetch-remotes" title="Permanent link">&para;</a></h3>
<p>Add all prepared repositories as remotes and fetch them.</p>
<pre class="codehilite"><code>⦁ project/project : master $ git remote add -f frontend ../frontend
⦁ project/project : master $ git remote add -f backend ../backend
...</code></pre>


<h3 id="merge-the-repositories">Merge the repositories<a class="headerlink" href="#merge-the-repositories" title="Permanent link">&para;</a></h3>
<p>Finally, merge all those remotes into the combined project. Simply repeat this step for every remote
you want to merge. At this point it pays off to prepare the repositories in order to avoid any merge
conflicts right away.</p>
<pre class="codehilite"><code>⦁ project/project : master $ git merge -s ours --no-commit --allow-unrelated-histories frontend/master
Automatic merge went well; stopped before committing as requested
⦁ project/project : master|MERGING $ git read-tree --prefix= -u frontend/master
⦁ project/project : master +|MERGING $ git commit -a
[master 96012d4] Merge remote-tracking branch 'frontend/master'</code></pre>


<p>You will end up with a repository where history looks somewhat like this:</p>
<pre class="codehilite"><code>⦁ project/project : master $ git log --graph
*   7a53ff5 2019-02-19 11:28:15 +0100 N Merge remote-tracking branch 'backend/master' (HEAD -&gt; master) [Anton Semjonov]
|\
| * f89bfa3 2019-02-18 16:57:07 +0100 N prepare backend for merge (backend/master) [Anton Semjonov]
| * ea8a4f7 2018-09-18 15:19:16 +0200 N update scripts [Anton Semjonov]
| [...]
*   96012d4 2019-02-19 11:27:49 +0100 N Merge remote-tracking branch 'frontend/master' [Anton Semjonov]
|\
| * c777b42 2019-02-18 16:57:56 +0100 N prepare frontend for merge (frontend/master) [Anton Semjonov]
| * e3812e2 2019-01-18 22:35:30 +0100 N korrigiere Leonhard [Anton Semjonov]
| [...]
* b0605af 2019-02-19 11:25:36 +0100 N prepare combined repository for project [Anton Semjonov]</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="gitlab.html" class="btn btn-neutral float-right" title="Gitlab">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="freeipa.html" class="btn btn-neutral" title="FreeIPA"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright (c) 2019 Anton Semjonov.
Licensed under a <a href="https://creativecommons.org/licenses/by-sa/4.0/" title="Creative Commons Attribution-ShareAlike 4.0">CC-BY-SA-4.0</a> license.
</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="freeipa.html" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="gitlab.html" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
